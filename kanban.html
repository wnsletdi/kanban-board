<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban –î–æ—Å–∫–∞ - –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .status {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status.connected {
            border-left: 5px solid #4CAF50;
        }

        .status.disconnected {
            border-left: 5px solid #f44336;
        }

        .board {
            display: flex;
            gap: 20px;
            min-height: 500px;
        }

        .column {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .column h2 {
            text-align: center;
            padding-bottom: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            color: #555;
        }

        .card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s;
            position: relative;
        }

        .card:hover {
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .card:active {
            cursor: grabbing;
        }

        .card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .add-card-form {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .add-card-form input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-card-form button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-card-form button:hover {
            background: #45a049;
        }

        .online-users {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .user-count {
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Kanban –î–æ—Å–∫–∞ (–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)</h1>
        
        <div id="status" class="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...</div>
        
        <div id="online-users" class="online-users">
            üë• –û–Ω–ª–∞–π–Ω: <span id="user-count" class="user-count">0</span>
        </div>

        <div class="board" id="board">
            <!-- –ö–æ–ª–æ–Ω–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;">
            –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –∏–ª–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É -->
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    
    <!-- –ù–∞—à JavaScript –∫–æ–¥ -->
    <script>
        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const BOARD_ID = "team-board-1"; // ID –Ω–∞—à–µ–π –¥–æ—Å–∫–∏
        let socket = null;
        let currentBoard = null;
        let draggedCard = null;

        // ==================== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –°–ï–†–í–ï–†–£ ====================
        function connectToServer() {
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É (–ø–æ—Ä—Ç 3001, –∫–æ—Ç–æ—Ä—ã–π –º—ã —É–∫–∞–∑–∞–ª–∏ –≤ server.js)
            socket = io();
            
            // –°–æ–±—ã—Ç–∏–µ: —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            socket.on('connect', () => {
                updateStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'connected');
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –¥–æ—Å–∫–µ
                socket.emit('join-board', BOARD_ID);
            });
            
            // –°–æ–±—ã—Ç–∏–µ: –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            socket.on('disconnect', () => {
                updateStatus('‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'disconnected');
            });
            
            // –°–æ–±—ã—Ç–∏–µ: –ø–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏
            socket.on('board-state', (boardData) => {
                console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏:', boardData);
                currentBoard = boardData;
                renderBoard(boardData);
            });
            
            // –°–æ–±—ã—Ç–∏–µ: –∫—Ç–æ-—Ç–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª –∫–∞—Ä—Ç–æ—á–∫—É
            socket.on('card-moved', (data) => {
                console.log('–î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª –∫–∞—Ä—Ç–æ—á–∫—É:', data);
                moveCardLocally(data.cardId, data.toColumnId);
            });
            
            // –°–æ–±—ã—Ç–∏–µ: –∫—Ç–æ-—Ç–æ —Å–æ–∑–¥–∞–ª –∫–∞—Ä—Ç–æ—á–∫—É
            socket.on('card-created', (cardData) => {
                console.log('–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞:', cardData);
                if (!currentBoard.cards.find(c => c.id === cardData.id)) {
                    currentBoard.cards.push(cardData);
                    renderBoard(currentBoard);
                }
            });
        }

        // ==================== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï ====================
        function updateStatus(text, className) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = `status ${className}`;
        }

        function renderBoard(board) {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            
            // –°–æ–∑–¥–∞—ë–º –∫–æ–ª–æ–Ω–∫–∏
            board.columns.forEach(column => {
                const columnEl = document.createElement('div');
                columnEl.className = 'column';
                columnEl.dataset.columnId = column.id;
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–ª–æ–Ω–∫–∏
                const titleEl = document.createElement('h2');
                titleEl.textContent = column.title;
                columnEl.appendChild(titleEl);
                
                // –ö–∞—Ä—Ç–æ—á–∫–∏ –≤ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–µ
                const cardsInColumn = board.cards.filter(card => card.columnId === column.id);
                cardsInColumn.forEach(card => {
                    const cardEl = createCardElement(card);
                    columnEl.appendChild(cardEl);
                });
                
                // –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
                const formEl = document.createElement('div');
                formEl.className = 'add-card-form';
                formEl.innerHTML = `
                    <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..." id="input-${column.id}">
                    <button onclick="addCard('${column.id}')">+</button>
                `;
                columnEl.appendChild(formEl);
                
                // –†–∞–∑—Ä–µ—à–∞–µ–º —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —ç—Ç—É –∫–æ–ª–æ–Ω–∫—É
                columnEl.addEventListener('dragover', handleDragOver);
                columnEl.addEventListener('drop', handleDrop);
                
                boardEl.appendChild(columnEl);
            });
        }

        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = 'card';
            cardEl.id = `card-${card.id}`;
            cardEl.draggable = true;
            cardEl.textContent = card.title;
            cardEl.dataset.cardId = card.id;
            cardEl.dataset.columnId = card.columnId;
            
            // –°–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            cardEl.addEventListener('dragstart', handleDragStart);
            cardEl.addEventListener('dragend', handleDragEnd);
            
            return cardEl;
        }

        // ==================== –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï ====================
        function handleDragStart(e) {
            draggedCard = {
                id: e.target.dataset.cardId,
                columnId: e.target.dataset.columnId
            };
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedCard = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (!draggedCard) return;
            
            const toColumnId = e.currentTarget.dataset.columnId;
            
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫—É –±—Ä–æ—Å–∏–ª–∏ –≤ —Ç—É –∂–µ –∫–æ–ª–æ–Ω–∫—É - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
            if (draggedCard.columnId === toColumnId) return;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            socket.emit('move-card', {
                cardId: draggedCard.id,
                fromColumnId: draggedCard.columnId,
                toColumnId: toColumnId,
                boardId: BOARD_ID
            });
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
            moveCardLocally(draggedCard.id, toColumnId);
        }

        function moveCardLocally(cardId, toColumnId) {
            const cardIndex = currentBoard.cards.findIndex(c => c.id === cardId);
            if (cardIndex !== -1) {
                currentBoard.cards[cardIndex].columnId = toColumnId;
                renderBoard(currentBoard);
            }
        }

        // ==================== –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–¢–û–ß–ï–ö ====================
        function addCard(columnId) {
            const input = document.getElementById(`input-${columnId}`);
            const title = input.value.trim();
            
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏!');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            socket.emit('create-card', {
                title: title,
                columnId: columnId,
                boardId: BOARD_ID
            });
            
            input.value = '';
        }

        // ==================== –ó–ê–ü–£–°–ö ====================
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
        window.onload = function() {
            connectToServer();
            
            // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
            window.addCard = addCard;
        };
    </script>
</body>
</html>